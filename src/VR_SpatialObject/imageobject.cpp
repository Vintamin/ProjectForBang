//
//
//  Generated by StarUML(tm) C++ Add-In
//
//  @ Project : 三维数字矿山平台
//  @ File Name : imageobject.cpp
//  @ Date : 2014/8/6
//  @ Author : 朱炜鹏
//  @ Implement : 
//  @ Company : 中国矿业大学(北京)
//  @ Copyright:  2014-2020
//  @ Description : 


#include "vrmine/vr_spatialobject/mine/imageobject.h"
#include "vrmine/vr_core/geodatatype.h"
#include "vrmine/vr_spatialobject/geoproperty/imageproperty.h"
#include "vrmine/vr_databaseengine/database/imagefeature.h"
#include "vrmine/vr_mathenine/mathengine/mathcalculator.h"
#include <iostream>

using namespace VirtualMine::GeoProperty;
using namespace VirtualMine::SpatialInterface;
using namespace VirtualMine::Core;

namespace VirtualMine
{
	namespace Mine
	{
		CImageObject::CImageObject()
		{
			this->setType(VirtualMine::Core::GeoDataType::GDT_IMAGE);
		}

		CImageObject::~CImageObject()
		{

		}

		VirtualMine::SpatialInterface::IStyle* CImageObject::getStyle()
		{
			//VirtualMine::SpatialInterface::IStyle* pStyle =  CGeoObject::getStyle();
			//if (pStyle == NULL)
			//{
			//	pStyle = new VirtualMine::Style::CDrillHoleStyle();
			//	CGeoObject::setStyle(pStyle,true);
			//	//delete pStyle;
			//}
			//return  CGeoObject::getStyle();
			return NULL;
		}

		VirtualMine::SpatialInterface::IGeometry* CImageObject::getGeometry()
		{
			//VirtualMine::SpatialInterface::IGeometry* pGeometry =  CGeoObject::getGeometry();
			//if (pGeometry == NULL)
			//{
			//	pGeometry = new  VirtualMine::Geometry::CDrillHoleGeometry();
			//	CGeoObject::setGeometry(pGeometry,true);
			//	// delete pStyle;
			//}
			//return  CGeoObject::getGeometry();
			return NULL;
		}

		VirtualMine::SpatialInterface::IGeoProperty* CImageObject::getGeoProperty()
		{
			VirtualMine::SpatialInterface::IGeoProperty* pGeoProperty =  CGeoObject::getGeoProperty();
			if (pGeoProperty == NULL)
			{
				pGeoProperty = new VirtualMine::GeoProperty::CImageProperty();
				CGeoObject::setGeoProperty(pGeoProperty,true);
				//delete pStyle;
			}
			return  CGeoObject::getGeoProperty();
		}

		/////路径默认
		 void CImageObject::fromFeature(VirtualMine::Database::IFeature* pFeature)
		 {
//			 assert(pFeature);
//			 if (NULL == pFeature)
//			 {
//				 return;
//			 }
//			 void* pData = dynamic_cast<VirtualMine::Database::CImageFeature*>(pFeature)->getPropertySet()->getFields().at(0).getVarient().data();
//			 int* id = (int*)pData;
//			 int getID = *id;
//
//			 void* pData1 = dynamic_cast<VirtualMine::Database::CImageFeature*>(pFeature)->getPropertySet()->getFields().at(1).getVarient().data();
//			 char* name = (char*)pData1;
//
//			 void* pData2 = dynamic_cast<VirtualMine::Database::CImageFeature*>(pFeature)->getPropertySet()->getFields().at(2).getVarient().data();
//			 Ogre::uchar* blob = static_cast<Ogre::uchar*>(pData2);
//			 int legth = dynamic_cast<VirtualMine::Database::CImageFeature*>(pFeature)->getPropertySet()->getFields().at(2).getVarient().getLength();
//			 
//
//			 char buffer2[1024] = "0";
//
//			 sprintf(buffer2, "%s", pData2);
//
//			 FILE *fp2;
//			 ///应该传进来
//			 std::string outname = "C:\\Users\\Administrator\\Desktop\\outfile.jpg";
//
//			 fp2 = fopen(outname.c_str(), "wb");
//
//			 if(fp2 != NULL)
//			 {
//				 size_t ret = fwrite(pData2, sizeof(char), legth, fp2);
//				 fclose(fp2);
//			 }
//
//
//#if 0			 
//			void *pMem = (void *)new  Ogre::uchar[legth]; 
//			memset(pMem, 0, legth); 
//			memcpy(pMem,pData2,legth); 
//
//			//把这些放入一个新创建的MemoryDataStream 
//			Ogre::DataStreamPtr dsptr(new Ogre::MemoryDataStream(pMem, legth)); 
//			/*Ogre::DataStreamPtr dsptr;
//			dsptr->write(pData2,legth);*/
//
//		    dsptr->seek(0);
//			Ogre::Image image;
//		
//		
//			//image.loadDynamicImage(blob,10,10,Ogre::PixelFormat::PF_A8B8G8R8);
//			image.load(dsptr);
//		
//			
//			/*std::string textname = VirtualMine::MathEngine::CMathCalculator::getCurrentDir();		
//			textname += "\\vrmineresourcegroup\\minetexture\\coalseam2.jpg";
//			*/
//			
//			std::string textname = "imagetest.jpg";
//			
//			image.save("D:\\imagetest2.jpg");
//			// 
//#endif
//

		 }

		 VirtualMine::Database::IFeature* CImageObject::toFeature()
		 { 
//			 VirtualMine::Database::CImageFeature* feature = new VirtualMine::Database::CImageFeature(); 
////		
////			 Ogre::Image image;
////			////youwenti
////			 image.load("surface.jpg",VirtualMine::Core::VR_MINE_DEFAULT_RESOURCE_GROUP);
////			 Ogre::DataStreamPtr dsp =  image.encode("jpg");
////			// Ogre::uchar* imagedata = image.getData();
////
////#if 1
////			 //////////////test
////			 image.save("D:\\22222.jpg");
////
////#endif
////
////			// int imagesize =  image.getSize();
////			 int size =  image.getSize();
////			 
////			 dsp->seek(0);
////			 void* buffer = new Ogre::uchar[size];
////			 dsp->read(buffer,size);
////
//			 
//			 std::string textname = VirtualMine::MathEngine::CMathCalculator::getCurrentDir();		
//			 textname += "\\vrmineresourcegroup\\minetexture\\surface.jpg";
//
//			 FILE *fp;
//			 long filesize = 0;
//			 char * ffile;
//
//			 fp = fopen(textname.c_str(), "rb");
//
//			 if(fp != NULL)
//			 {
//				 fseek(fp, 0, SEEK_END);
//				 filesize = ftell(fp);
//				 fseek(fp, 0, SEEK_SET);
//
//				 ffile = new char[filesize+1];
//				 size_t sz = fread(ffile, sizeof(char), filesize+1, fp);
//
//				 fclose(fp);
//
//			 }
//
//
//			 feature->setFieldID(1);
//			 feature->setFieldName("Surface");
//		     feature->setFieldBlob((Ogre::uchar*)ffile,filesize);
//		   		
//			 return feature;

			 //////////////////////////////////////////////////////////////////////////
			 return NULL;
		 }

	}

}
