//#include "stdafx.h"


//
//  Generated by StarUML(tm) C++ Add-In
//
//  @ Project : 三维数字矿山平台
//  @ File Name : Delaunay.cpp
//  @ Date : 2015/6/18
//  @ Author : 王向上
//  @ Implement : 
//  @ Company : 中国矿业大学(北京)
//  @ Copyright:  2014-2020
//  @ Description : 

#include "vrmine/vr_spatialanalyse/spatialanalyse/iso_contour.h"

namespace VirtualMine
{
	namespace SpatialAnalyse
	{
		iso_contour::iso_contour()
		 {

	
		}
		iso_contour::~iso_contour()
		{

		}
	    std::vector<De_point> iso_contour::isoline_con(std::vector<De_point>& V,double h)
		{
			h=h+0.1111111;
			std::vector<De_point> Cp;

			for ( int i=0;i<V.size();i+=3)
			{
			
			  De_point m=V.at(i);
			  De_point n=V.at(i+1);
			  De_point p=V.at(i+2);
				if ((m.z-h)*(n.z-h)<0)
				{
					first_1.x=(int)(m.x+(n.x-m.x)*(h-m.z)/(n.z-m.z));
					first_1.y=(int)(m.y+(n.y-m.y)*(h-m.z)/(n.z-m.z));
					first_1.z=h-0.1;
				//	L.m=first_1;
					Cp.push_back(first_1);
					
					if ((m.z-h)*(p.z-h)<0)
					{
						second_2.x=(int)(m.x+(p.x-m.x)*(h-m.z)/(p.z-m.z));
						second_2.y=(int)(m.y+(p.y-m.y)*(h-m.z)/(p.z-m.z));
						second_2.z=h-0.1;
					//	L.n=second_2;
						Cp.push_back(second_2);
					} 
					else 
					{
						second_2.x=(int)(n.x+(p.x-n.x)*(h-n.z)/(p.z-n.z));
						second_2.y=(int)(n.y+(p.y-n.y)*(h-n.z)/(p.z-n.z));
						second_2.z=h-0.1;
						//L.n=second_2;
						Cp.push_back(second_2);
					}
				} 
				else if((m.z-h)*(p.z-h)<0)
				{
					first_1.x=(int)(m.x+(p.x-m.x)*(h-m.z)/(p.z-m.z));
					first_1.y=(int)(m.y+(p.y-m.y)*(h-m.z)/(p.z-m.z));
					first_1.z=h-0.1;
				//	L.m=first_1;
					Cp.push_back(first_1);
					second_2.x=(int)(n.x+(p.x-n.x)*(h-n.z)/(p.z-n.z));
					second_2.y=(int)(n.y+(p.y-n.y)*(h-n.z)/(p.z-n.z));
					second_2.z=h-0.1;
					//L.n=second_2;
					Cp.push_back(second_2);
//
				}
				
		
			}
			//return Lp;
			return Cp;

		}



	}
}